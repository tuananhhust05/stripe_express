<!DOCTYPE html>
<html lang="en">
  <%- include('partials/head', { title }) %>
  <body style="background: var(--bg); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 2rem; position: relative; overflow: hidden;">
    <!-- Background effects -->
    <div style="position: fixed; inset: 0; pointer-events: none; z-index: 0;">
      <div style="position: absolute; width: 420px; height: 420px; border-radius: 50%; filter: blur(60px); opacity: 0.3; background: radial-gradient(circle at 30% 30%, var(--accent) 0%, transparent 65%); top: -120px; left: -80px; animation: floatGlow 14s ease-in-out infinite;"></div>
      <div style="position: absolute; width: 520px; height: 520px; border-radius: 50%; filter: blur(60px); opacity: 0.25; background: radial-gradient(circle at 70% 70%, var(--accent-strong) 0%, transparent 70%); bottom: -180px; right: -40px; animation: floatGlow 18s ease-in-out infinite; animation-delay: 3s; mix-blend-mode: screen;"></div>
    </div>
    <style>
      @keyframes floatGlow {
        0%, 100% { transform: translate3d(0, 0, 0) scale(1); opacity: 0.3; }
        50% { transform: translate3d(20px, -30px, 0) scale(1.08); opacity: 0.4; }
      }
    </style>
    <div style="width: 100%; max-width: 420px; background: var(--bg-card); border-radius: 24px; padding: 3rem; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); border: 1px solid var(--border-light); position: relative; z-index: 1;">
      <div style="text-align: center; margin-bottom: 2.5rem;">
        <a href="/" style="display: inline-block; margin-bottom: 1rem;">
          <span style="color: var(--text); font-size: 1.5rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase;">Shadow Link</span>
        </a>
        <h1 style="margin: 0 0 0.5rem 0; color: var(--text); font-size: 2rem; font-weight: 600;">Create Account</h1>
        <p style="margin: 0; color: var(--muted); font-size: 0.95rem;">Start your journey with Shadow Link</p>
      </div>
      
      <div id="error-message" style="display: none; background: #ff3b30; color: white; padding: 0.75rem 1rem; border-radius: 8px; margin-bottom: 1.5rem; font-size: 0.9rem;"></div>

      <form id="register-form">
        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500; font-size: 0.9rem;">Name (optional)</label>
          <input 
            type="text" 
            id="name"
            name="name"
            style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; box-sizing: border-box;"
            placeholder="Your name"
          />
        </div>

        <div style="margin-bottom: 1.5rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500; font-size: 0.9rem;">Email</label>
          <input 
            type="email" 
            id="email"
            name="email" 
            required 
            autofocus
            style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; box-sizing: border-box;"
            placeholder="your@email.com"
          />
        </div>

        <div style="margin-bottom: 2rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 500; font-size: 0.9rem;">Password</label>
          <input 
            type="password" 
            id="password"
            name="password" 
            required
            minlength="6"
            style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); font-size: 1rem; box-sizing: border-box;"
            placeholder="At least 6 characters"
          />
        </div>

        <button 
          type="submit" 
          id="submit-btn"
          class="btn primary full"
          style="width: 100%; padding: 0.75rem 1.75rem; margin-bottom: 1rem;"
        >
          Create Account
        </button>
      </form>

      <p style="text-align: center; color: var(--muted); font-size: 0.9rem; margin-top: 1.5rem;">
        Already have an account? <a href="/login" style="color: var(--accent); text-decoration: none; font-weight: 500;">Sign in</a>
      </p>

      <script>
        const form = document.getElementById('register-form');
        const errorDiv = document.getElementById('error-message');
        const submitBtn = document.getElementById('submit-btn');

        form.addEventListener('submit', async (event) => {
          event.preventDefault();
          
          const name = document.getElementById('name').value;
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          
          if (password.length < 6) {
            errorDiv.textContent = 'Password must be at least 6 characters';
            errorDiv.style.display = 'block';
            return;
          }
          
          submitBtn.disabled = true;
          submitBtn.textContent = 'Creating account...';
          errorDiv.style.display = 'none';

          try {
            const response = await fetch('/api/users/register', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ name, email, password })
            });

            const result = await response.json();

            if (result.success) {
              window.location.href = '/subscription';
            } else {
              errorDiv.textContent = result.error || 'Registration failed';
              errorDiv.style.display = 'block';
              submitBtn.disabled = false;
              submitBtn.textContent = 'Create Account';
            }
          } catch (error) {
            errorDiv.textContent = 'Network error. Please try again.';
            errorDiv.style.display = 'block';
            submitBtn.disabled = false;
            submitBtn.textContent = 'Create Account';
          }
        });
      </script>
    </div>
  </body>
</html>


